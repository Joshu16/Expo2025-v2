<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056CC; }
        .danger { background: #FF3B30; }
        .success { background: #34C759; }
        .warning { background: #FF9500; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success-status { background: #d4edda; color: #155724; }
        .error-status { background: #f8d7da; color: #721c24; }
        .info-status { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug de la Aplicaci√≥n</h1>
        <p>Herramientas para diagnosticar problemas en la aplicaci√≥n de adopci√≥n de mascotas.</p>
        
        <button onclick="checkFirebase()">üß™ Verificar Firebase</button>
        <button onclick="checkCollections()">üìä Ver Colecciones</button>
        <button onclick="checkPets()">üêï Ver Mascotas</button>
        <button onclick="checkFavorites()">‚ù§Ô∏è Ver Favoritos</button>
        <button onclick="checkAdoptionRequests()">üìã Ver Solicitudes</button>
        <button onclick="checkCategories()">üìÇ Ver Categor√≠as</button>
        <button onclick="clearAll()" class="danger">üóëÔ∏è Limpiar Todo</button>
        
        <div id="status"></div>
        <div id="results"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, deleteDoc, doc, addDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBZ28tY4uu7Ec0pou2vQl9PlEiqU0IFc4U",
            authDomain: "animals-adoption-app.firebaseapp.com",
            projectId: "animals-adoption-app",
            storageBucket: "animals-adoption-app.firebasestorage.app",
            messagingSenderId: "360360840693",
            appId: "1:360360840693:web:f81ab7be2be926eca5a4bc",
            measurementId: "G-HDDQLXGS7R"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function showStatus(message, type = 'info') {
            document.getElementById('status').innerHTML = `<div class="status ${type}-status">${message}</div>`;
        }

        function showResults(data) {
            document.getElementById('results').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        async function checkFirebase() {
            try {
                showStatus('üß™ Verificando conexi√≥n a Firebase...', 'info');
                const testRef = collection(db, 'test');
                await addDoc(testRef, { test: true, timestamp: new Date().toISOString() });
                showStatus('‚úÖ Firebase conectado correctamente', 'success');
                showResults({ status: 'connected', timestamp: new Date().toISOString() });
            } catch (error) {
                showStatus('‚ùå Error de conexi√≥n: ' + error.message, 'error');
                showResults({ error: error.message });
            }
        }

        async function checkCollections() {
            try {
                showStatus('üìä Verificando colecciones...', 'info');
                const collections = ['pets', 'favorites', 'adoptionRequests', 'categories', 'users'];
                const results = {};
                
                for (const collectionName of collections) {
                    try {
                        const snapshot = await getDocs(collection(db, collectionName));
                        results[collectionName] = {
                            count: snapshot.size,
                            docs: snapshot.docs.map(doc => ({ id: doc.id, data: doc.data() }))
                        };
                    } catch (error) {
                        results[collectionName] = { error: error.message };
                    }
                }
                
                showStatus('‚úÖ Colecciones verificadas', 'success');
                showResults(results);
            } catch (error) {
                showStatus('‚ùå Error verificando colecciones: ' + error.message, 'error');
                showResults({ error: error.message });
            }
        }

        async function checkPets() {
            try {
                showStatus('üêï Verificando mascotas...', 'info');
                const snapshot = await getDocs(collection(db, 'pets'));
                const pets = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                showStatus(`‚úÖ Encontradas ${pets.length} mascotas`, 'success');
                showResults(pets);
            } catch (error) {
                showStatus('‚ùå Error verificando mascotas: ' + error.message, 'error');
                showResults({ error: error.message });
            }
        }

        async function checkFavorites() {
            try {
                showStatus('‚ù§Ô∏è Verificando favoritos...', 'info');
                const snapshot = await getDocs(collection(db, 'favorites'));
                const favorites = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                showStatus(`‚úÖ Encontrados ${favorites.length} favoritos`, 'success');
                showResults(favorites);
            } catch (error) {
                showStatus('‚ùå Error verificando favoritos: ' + error.message, 'error');
                showResults({ error: error.message });
            }
        }

        async function checkAdoptionRequests() {
            try {
                showStatus('üìã Verificando solicitudes de adopci√≥n...', 'info');
                const snapshot = await getDocs(collection(db, 'adoptionRequests'));
                const requests = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                showStatus(`‚úÖ Encontradas ${requests.length} solicitudes`, 'success');
                showResults(requests);
            } catch (error) {
                showStatus('‚ùå Error verificando solicitudes: ' + error.message, 'error');
                showResults({ error: error.message });
            }
        }

        async function checkCategories() {
            try {
                showStatus('üìÇ Verificando categor√≠as...', 'info');
                const snapshot = await getDocs(collection(db, 'categories'));
                const categories = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                showStatus(`‚úÖ Encontradas ${categories.length} categor√≠as`, 'success');
                showResults(categories);
            } catch (error) {
                showStatus('‚ùå Error verificando categor√≠as: ' + error.message, 'error');
                showResults({ error: error.message });
            }
        }

        async function clearAll() {
            if (!confirm('¬øEst√°s seguro de que quieres limpiar TODA la base de datos?')) return;
            
            try {
                showStatus('üóëÔ∏è Limpiando base de datos...', 'warning');
                const collections = ['pets', 'favorites', 'adoptionRequests', 'categories', 'test'];
                let totalDeleted = 0;
                
                for (const collectionName of collections) {
                    try {
                        const snapshot = await getDocs(collection(db, collectionName));
                        for (const docSnapshot of snapshot.docs) {
                            await deleteDoc(doc(db, collectionName, docSnapshot.id));
                            totalDeleted++;
                        }
                    } catch (error) {
                        console.error(`Error cleaning ${collectionName}:`, error);
                    }
                }
                
                showStatus(`‚úÖ Base de datos limpiada. ${totalDeleted} documentos eliminados`, 'success');
                showResults({ deleted: totalDeleted, collections: collections });
            } catch (error) {
                showStatus('‚ùå Error limpiando base de datos: ' + error.message, 'error');
                showResults({ error: error.message });
            }
        }

        // Hacer funciones disponibles globalmente
        window.checkFirebase = checkFirebase;
        window.checkCollections = checkCollections;
        window.checkPets = checkPets;
        window.checkFavorites = checkFavorites;
        window.checkAdoptionRequests = checkAdoptionRequests;
        window.checkCategories = checkCategories;
        window.clearAll = clearAll;
    </script>
</body>
</html>
